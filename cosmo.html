<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Astrology Homepage</title>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    
    .planet-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .planet-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(138, 43, 226, 0.3);
    }
    
    .blog-card {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .blog-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(138, 43, 226, 0.2);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto" style="background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); min-height: 100%;"><!-- Stars Background -->
   <div id="stars-container" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0;"></div><!-- Main Content -->
   <div style="position: relative; z-index: 1;"><!-- Header -->
    <header style="padding: 3rem 2rem; text-align: center;">
     <h1 id="site-title" style="font-size: 3rem; font-weight: bold; margin-bottom: 0.5rem; background: linear-gradient(to right, #a78bfa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">Celestial Wisdom</h1>
     <p id="site-tagline" style="font-size: 1.25rem; color: #e9d5ff;">Your guide to the cosmos</p>
    </header><!-- Current Placements Section -->
    <section style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
     <div style="text-align: center; margin-bottom: 2rem;">
      <h2 id="placements-title" style="font-size: 2rem; font-weight: bold; color: #f3e8ff; margin-bottom: 0.5rem;">Current Planetary Placements</h2>
      <p id="placements-subtitle" style="color: #e9d5ff;">Updated cosmic alignments</p>
     </div>
     <div id="placements-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;"><!-- Placement cards will be added here -->
     </div>
     <div style="text-align: center; margin-top: 2rem;"><button id="add-placement-btn" style="background: linear-gradient(to right, #8b5cf6, #a78bfa); color: white; padding: 0.75rem 2rem; border-radius: 9999px; font-weight: 600; border: none; cursor: pointer; transition: transform 0.2s;"> ➕ Add Placement </button>
     </div><!-- Add Placement Form -->
     <div id="placement-form" style="display: none; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 1rem; padding: 2rem; margin-top: 2rem; border: 1px solid rgba(255, 255, 255, 0.2);">
      <h3 style="font-size: 1.5rem; font-weight: bold; color: #f3e8ff; margin-bottom: 1.5rem;">Add New Placement</h3>
      <form id="new-placement-form">
       <div style="margin-bottom: 1rem;"><label for="planet-name" style="display: block; color: #e9d5ff; margin-bottom: 0.5rem; font-weight: 500;">Planet</label> <input type="text" id="planet-name" required style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 1rem;">
       </div>
       <div style="margin-bottom: 1rem;"><label for="planet-sign" style="display: block; color: #e9d5ff; margin-bottom: 0.5rem; font-weight: 500;">Sign</label> <input type="text" id="planet-sign" required style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 1rem;">
       </div>
       <div style="margin-bottom: 1rem;"><label for="planet-degree" style="display: block; color: #e9d5ff; margin-bottom: 0.5rem; font-weight: 500;">Degree</label> <input type="text" id="planet-degree" required style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 1rem;">
       </div>
       <div style="display: flex; gap: 1rem;"><button type="submit" id="save-placement-btn" style="flex: 1; background: linear-gradient(to right, #8b5cf6, #a78bfa); color: white; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer;"> Save Placement </button> <button type="button" id="cancel-placement-btn" style="flex: 1; background: rgba(255, 255, 255, 0.1); color: #e9d5ff; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; border: 1px solid rgba(255, 255, 255, 0.3); cursor: pointer;"> Cancel </button>
       </div>
      </form>
     </div>
    </section><!-- Blog Section -->
    <section style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
     <div style="text-align: center; margin-bottom: 2rem;">
      <h2 id="blog-title" style="font-size: 2rem; font-weight: bold; color: #f3e8ff; margin-bottom: 1rem;">Latest Insights</h2><button id="add-post-btn" style="background: linear-gradient(to right, #8b5cf6, #a78bfa); color: white; padding: 0.75rem 2rem; border-radius: 9999px; font-weight: 600; border: none; cursor: pointer; transition: transform 0.2s;"> ✨ Write New Post </button>
     </div><!-- Add Post Form -->
     <div id="post-form" style="display: none; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; border: 1px solid rgba(255, 255, 255, 0.2);">
      <h3 style="font-size: 1.5rem; font-weight: bold; color: #f3e8ff; margin-bottom: 1.5rem;">Write New Blog Post</h3>
      <form id="new-post-form">
       <div style="margin-bottom: 1rem;"><label for="post-title" style="display: block; color: #e9d5ff; margin-bottom: 0.5rem; font-weight: 500;">Post Title</label> <input type="text" id="post-title" required style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 1rem;">
       </div>
       <div style="margin-bottom: 1rem;"><label for="post-content" style="display: block; color: #e9d5ff; margin-bottom: 0.5rem; font-weight: 500;">Content</label> <textarea id="post-content" required rows="6" style="width: 100%; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: white; font-size: 1rem; resize: vertical;"></textarea>
       </div>
       <div style="display: flex; gap: 1rem;"><button type="submit" id="save-post-btn" style="flex: 1; background: linear-gradient(to right, #8b5cf6, #a78bfa); color: white; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; border: none; cursor: pointer;"> Publish Post </button> <button type="button" id="cancel-post-btn" style="flex: 1; background: rgba(255, 255, 255, 0.1); color: #e9d5ff; padding: 0.75rem; border-radius: 0.5rem; font-weight: 600; border: 1px solid rgba(255, 255, 255, 0.3); cursor: pointer;"> Cancel </button>
       </div>
      </form>
     </div><!-- Blog Posts Grid -->
     <div id="blog-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem;"><!-- Blog posts will be added here -->
     </div>
     <div id="empty-blog" style="text-align: center; padding: 3rem; color: #e9d5ff;">
      <p style="font-size: 1.125rem;">No blog posts yet. Share your cosmic wisdom!</p>
     </div>
    </section><!-- Footer -->
    <footer style="text-align: center; padding: 2rem; color: #e9d5ff; margin-top: 3rem;">
     <p>✨ May the stars guide your journey ✨</p>
    </footer>
   </div>
  </div>
  <script>
    const defaultConfig = {
      site_title: "Celestial Wisdom",
      site_tagline: "Your guide to the cosmos",
      placements_title: "Current Planetary Placements",
      placements_subtitle: "Updated cosmic alignments",
      blog_title: "Latest Insights",
      add_post_button: "Write New Post",
      background_color: "#0f0c29",
      surface_color: "#1e1b3e",
      text_color: "#f3e8ff",
      primary_action_color: "#8b5cf6",
      secondary_action_color: "#e9d5ff",
      font_family: "system-ui",
      font_size: 16
    };

    let blogPosts = [];
    let placements = [];
    let editingPostId = null;
    let editingPlacementId = null;

    // Create stars
    function createStars() {
      const container = document.getElementById('stars-container');
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.width = Math.random() * 2 + 1 + 'px';
        star.style.height = star.style.width;
        star.style.animationDelay = Math.random() * 3 + 's';
        container.appendChild(star);
      }
    }

    async function onConfigChange(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const fontFamily = `${customFont}, ${baseFontStack}`;

      // Update text content
      document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
      document.getElementById('site-tagline').textContent = config.site_tagline || defaultConfig.site_tagline;
      document.getElementById('placements-title').textContent = config.placements_title || defaultConfig.placements_title;
      document.getElementById('placements-subtitle').textContent = config.placements_subtitle || defaultConfig.placements_subtitle;
      document.getElementById('blog-title').textContent = config.blog_title || defaultConfig.blog_title;
      document.getElementById('add-post-btn').textContent = '✨ ' + (config.add_post_button || defaultConfig.add_post_button);

      // Update colors
      const bgColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_action_color || defaultConfig.primary_action_color;
      const secondaryColor = config.secondary_action_color || defaultConfig.secondary_action_color;

      document.getElementById('app').style.background = `linear-gradient(to bottom, ${bgColor}, ${surfaceColor}, ${bgColor})`;
      document.getElementById('site-title').style.color = textColor;
      document.getElementById('site-tagline').style.color = secondaryColor;
      document.getElementById('placements-title').style.color = textColor;
      document.getElementById('placements-subtitle').style.color = secondaryColor;
      document.getElementById('blog-title').style.color = textColor;

      // Update fonts
      document.getElementById('site-title').style.fontFamily = fontFamily;
      document.getElementById('site-title').style.fontSize = `${baseSize * 2}px`;
      document.getElementById('site-tagline').style.fontFamily = fontFamily;
      document.getElementById('site-tagline').style.fontSize = `${baseSize * 1.25}px`;
      document.getElementById('placements-title').style.fontFamily = fontFamily;
      document.getElementById('placements-title').style.fontSize = `${baseSize * 1.5}px`;
      document.getElementById('placements-subtitle').style.fontFamily = fontFamily;
      document.getElementById('placements-subtitle').style.fontSize = `${baseSize}px`;
      document.getElementById('blog-title').style.fontFamily = fontFamily;
      document.getElementById('blog-title').style.fontSize = `${baseSize * 1.5}px`;

      // Update buttons
      const buttons = document.querySelectorAll('button');
      buttons.forEach(btn => {
        btn.style.fontFamily = fontFamily;
        btn.style.fontSize = `${baseSize}px`;
        if (btn.id === 'add-post-btn' || btn.id === 'add-placement-btn' || btn.id === 'save-post-btn' || btn.id === 'save-placement-btn') {
          btn.style.background = `linear-gradient(to right, ${primaryColor}, ${secondaryColor})`;
        }
      });

      renderPlacements();
      renderBlogPosts();
    }

    function renderPlacements() {
      const grid = document.getElementById('placements-grid');
      grid.innerHTML = '';

      placements.forEach(placement => {
        const card = document.createElement('div');
        card.className = 'planet-card';
        card.style.cssText = `
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          border-radius: 1rem;
          padding: 1.5rem;
          border: 1px solid rgba(255, 255, 255, 0.2);
        `;

        card.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
            <div>
              <h3 style="font-size: 1.5rem; font-weight: bold; color: #f3e8ff; margin-bottom: 0.25rem;">${placement.planet}</h3>
              <p style="font-size: 1.25rem; color: #c4b5fd;">in ${placement.sign}</p>
            </div>
            <button class="delete-placement" data-id="${placement.id}" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid rgba(239, 68, 68, 0.4); cursor: pointer; font-size: 0.875rem;">
              Delete
            </button>
          </div>
          <p style="font-size: 1.125rem; color: #e9d5ff;">Degree: ${placement.degree}</p>
        `;

        grid.appendChild(card);
      });

      // Add delete listeners
      document.querySelectorAll('.delete-placement').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.dataset.id;
          const placement = placements.find(p => p.id === id);
          if (placement) {
            btn.disabled = true;
            btn.textContent = 'Deleting...';
            const result = await window.dataSdk.delete(placement);
            if (!result.isOk) {
              btn.disabled = false;
              btn.textContent = 'Delete';
            }
          }
        });
      });
    }

    function renderBlogPosts() {
      const grid = document.getElementById('blog-grid');
      const emptyState = document.getElementById('empty-blog');
      
      if (blogPosts.length === 0) {
        grid.style.display = 'none';
        emptyState.style.display = 'block';
        return;
      }

      grid.style.display = 'grid';
      emptyState.style.display = 'none';
      grid.innerHTML = '';

      blogPosts.forEach(post => {
        const card = document.createElement('div');
        card.className = 'blog-card';
        card.style.cssText = `
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          border-radius: 1rem;
          padding: 1.5rem;
          border: 1px solid rgba(255, 255, 255, 0.2);
        `;

        const date = new Date(post.date);
        const formattedDate = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

        card.innerHTML = `
          <div style="margin-bottom: 1rem;">
            <h3 style="font-size: 1.5rem; font-weight: bold; color: #f3e8ff; margin-bottom: 0.5rem;">${post.title}</h3>
            <p style="font-size: 0.875rem; color: #c4b5fd;">${formattedDate}</p>
          </div>
          <p style="color: #e9d5ff; line-height: 1.6; margin-bottom: 1rem;">${post.content}</p>
          <button class="delete-post" data-id="${post.id}" style="background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 0.5rem 1rem; border-radius: 0.5rem; border: 1px solid rgba(239, 68, 68, 0.4); cursor: pointer; font-size: 0.875rem;">
            Delete Post
          </button>
        `;

        grid.appendChild(card);
      });

      // Add delete listeners
      document.querySelectorAll('.delete-post').forEach(btn => {
        btn.addEventListener('click', async () => {
          const id = btn.dataset.id;
          const post = blogPosts.find(p => p.id === id);
          if (post) {
            btn.disabled = true;
            btn.textContent = 'Deleting...';
            const result = await window.dataSdk.delete(post);
            if (!result.isOk) {
              btn.disabled = false;
              btn.textContent = 'Delete Post';
            }
          }
        });
      });
    }

    const dataHandler = {
      onDataChanged(data) {
        blogPosts = data.filter(item => item.title && item.content);
        placements = data.filter(item => item.planet && item.sign);
        renderPlacements();
        renderBlogPosts();
      }
    };

    // Post form handlers
    document.getElementById('add-post-btn').addEventListener('click', () => {
      document.getElementById('post-form').style.display = 'block';
      editingPostId = null;
      document.getElementById('new-post-form').reset();
    });

    document.getElementById('cancel-post-btn').addEventListener('click', () => {
      document.getElementById('post-form').style.display = 'none';
      document.getElementById('new-post-form').reset();
      editingPostId = null;
    });

    document.getElementById('new-post-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (blogPosts.length >= 999) {
        const messageDiv = document.createElement('div');
        messageDiv.style.cssText = 'background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; border: 1px solid rgba(239, 68, 68, 0.4);';
        messageDiv.textContent = 'Maximum limit of 999 posts reached. Please delete some posts first.';
        document.getElementById('post-form').appendChild(messageDiv);
        setTimeout(() => messageDiv.remove(), 3000);
        return;
      }

      const submitBtn = document.getElementById('save-post-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Publishing...';

      const title = document.getElementById('post-title').value;
      const content = document.getElementById('post-content').value;

      const result = await window.dataSdk.create({
        id: Date.now().toString(),
        title,
        content,
        date: new Date().toISOString(),
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        document.getElementById('post-form').style.display = 'none';
        document.getElementById('new-post-form').reset();
      } else {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = 'background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; border: 1px solid rgba(239, 68, 68, 0.4);';
        errorDiv.textContent = 'Failed to publish post. Please try again.';
        document.getElementById('post-form').appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 3000);
      }

      submitBtn.disabled = false;
      submitBtn.textContent = 'Publish Post';
    });

    // Placement form handlers
    document.getElementById('add-placement-btn').addEventListener('click', () => {
      document.getElementById('placement-form').style.display = 'block';
      editingPlacementId = null;
      document.getElementById('new-placement-form').reset();
    });

    document.getElementById('cancel-placement-btn').addEventListener('click', () => {
      document.getElementById('placement-form').style.display = 'none';
      document.getElementById('new-placement-form').reset();
      editingPlacementId = null;
    });

    document.getElementById('new-placement-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      if (placements.length >= 999) {
        const messageDiv = document.createElement('div');
        messageDiv.style.cssText = 'background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; border: 1px solid rgba(239, 68, 68, 0.4);';
        messageDiv.textContent = 'Maximum limit of 999 placements reached. Please delete some placements first.';
        document.getElementById('placement-form').appendChild(messageDiv);
        setTimeout(() => messageDiv.remove(), 3000);
        return;
      }

      const submitBtn = document.getElementById('save-placement-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Saving...';

      const planet = document.getElementById('planet-name').value;
      const sign = document.getElementById('planet-sign').value;
      const degree = document.getElementById('planet-degree').value;

      const result = await window.dataSdk.create({
        id: Date.now().toString(),
        planet,
        sign,
        degree,
        createdAt: new Date().toISOString()
      });

      if (result.isOk) {
        document.getElementById('placement-form').style.display = 'none';
        document.getElementById('new-placement-form').reset();
      } else {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = 'background: rgba(239, 68, 68, 0.2); color: #fca5a5; padding: 1rem; border-radius: 0.5rem; margin-top: 1rem; border: 1px solid rgba(239, 68, 68, 0.4);';
        errorDiv.textContent = 'Failed to save placement. Please try again.';
        document.getElementById('placement-form').appendChild(errorDiv);
        setTimeout(() => errorDiv.remove(), 3000);
      }

      submitBtn.disabled = false;
      submitBtn.textContent = 'Save Placement';
    });

    // Initialize
    async function init() {
      createStars();

      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error('Failed to initialize data SDK');
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities: (config) => ({
            recolorables: [
              {
                get: () => config.background_color || defaultConfig.background_color,
                set: (value) => {
                  config.background_color = value;
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => config.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  config.surface_color = value;
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => config.text_color || defaultConfig.text_color,
                set: (value) => {
                  config.text_color = value;
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => config.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  config.primary_action_color = value;
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  config.secondary_action_color = value;
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => config.font_family || defaultConfig.font_family,
              set: (value) => {
                config.font_family = value;
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => config.font_size || defaultConfig.font_size,
              set: (value) => {
                config.font_size = value;
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          }),
          mapToEditPanelValues: (config) => new Map([
            ['site_title', config.site_title || defaultConfig.site_title],
            ['site_tagline', config.site_tagline || defaultConfig.site_tagline],
            ['placements_title', config.placements_title || defaultConfig.placements_title],
            ['placements_subtitle', config.placements_subtitle || defaultConfig.placements_subtitle],
            ['blog_title', config.blog_title || defaultConfig.blog_title],
            ['add_post_button', config.add_post_button || defaultConfig.add_post_button]
          ])
        });
      }

      await onConfigChange(defaultConfig);
    }

    init();
  </script>
</html>
